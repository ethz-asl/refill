#!/usr/bin/env python
# Disable pylint filename and missing module member complaints.
# pylint: disable=C0103,E1101
""" Simple git pre-commit script for executing googles c++ linter """

import commands
import imp
import re


def main():
    """ Checks for staged files and executes cpplint on them. """
    _, output = commands.getstatusoutput('git diff --staged --name-only')
    _, repo_root = commands.getstatusoutput('git rev-parse --show-toplevel')
    staged_files = output.split("\n")

    cpplint = imp.load_source('cpplint', repo_root+"/devtools/cpplint.py")
    for changed_file in staged_files:
        if re.search(r'\.(cc|h)$', changed_file):
            changed_file = repo_root + "/" + changed_file
            cpplint.ProcessFile(changed_file, 0)

    if cpplint._cpplint_state.error_count:
        print 'cpplint complains. Aborting commit.'
        exit(cpplint._cpplint_state.error_count)
    else:
        print 'cpplint successfull. Conitnuing with commit.'


if __name__ == "__main__":
    main()
